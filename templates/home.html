{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}CryptoFarm ‚Äî –ú–æ–∏ –¥–µ—Ä–µ–≤—å—è{% endblock %}

{% block content %}
<style>
.cf-summary-actions{
  display:flex;
  justify-content:center;
  margin: 10px 0 14px 0;
}

.cf-help-btn{
  border:none;
  border-radius: 999px;
  padding: 10px 16px;
  font-weight: 800;
  font-size: 0.9rem;
  background: rgba(255,255,255,0.85);
  color:#111;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
}

.custom-modal{
  display:none;
  position:fixed;
  z-index:9999;
  inset:0;
  background: rgba(0,0,0,0.35);
  justify-content:center;
  align-items:center;
  padding: 16px;
}

.custom-modal.active{
  display:flex;
}

/* —Å–∞–º–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ */
.custom-modal-content{
  width: 92vw;
  max-width: 420px;
  background: #f7f8ff;
  border-radius: 16px;
  padding: 14px 14px 12px 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.18);
  position:relative;
  color:#111;
}

/* –∫—Ä–µ—Å—Ç–∏–∫ */
.custom-modal-close{
  position:absolute;
  top:10px;
  right:10px;
  width: 36px;
  height: 36px;
  border:none;
  border-radius: 10px;
  background: rgba(0,0,0,0.06);
  color:#111;
  font-size: 22px;
  line-height: 1;
}

.instruction-title{
  margin: 0 0 10px 0;
  font-size: 1rem;
  font-weight: 900;
  color:#111;
}

.instruction-text{
  max-height: 62vh;
  overflow:auto;
  padding-right: 6px;
}

.instruction-text h4{
  margin: 10px 0 6px 0;
  font-size: 0.95rem;
  font-weight: 800;
}
.instruction-text h5{
  margin: 8px 0 4px 0;
  font-size: 0.9rem;
  font-weight: 800;
}

.instruction-text p,
.instruction-text li{
  font-size: 0.88rem;
  line-height: 1.35;
  color:#111;
}

.instruction-text ul{ margin: 0 0 8px 18px; }
.instruction-text ol{ margin: 6px 0 8px 18px; }

.instruction-hr{
  border: none;
  border-top: 1px solid rgba(0,0,0,0.12);
  margin: 10px 0;
}

.instruction-badge{
  display:inline-block;
  padding: 6px 10px;
  border-radius: 10px;
  background: rgba(47,128,255,0.12);
  font-weight: 800;
  font-size: 0.85rem;
  margin: 6px 0 6px 0;
}
.instruction-badge.warn{
  background: rgba(255,90,143,0.12);
}

.instruction-table{
  width:100%;
  border-collapse: collapse;
  margin: 6px 0 10px 0;
  font-size: 0.88rem;
}
.instruction-table th,
.instruction-table td{
  border: 1px solid rgba(0,0,0,0.12);
  padding: 6px 8px;
  text-align: left;
}
.instruction-table th{
  font-weight: 900;
  background: rgba(0,0,0,0.04);
}

.rps-table-title{
  margin-top: 6px;
  font-weight: 800;
  font-size: 0.88rem;
}

.instruction-ok{
  width:100%;
  margin-top: 10px;
  border:none;
  border-radius: 12px;
  padding: 10px 12px;
  background:#2f80ff;
  color:#fff;
  font-weight: 900;
  font-size: 0.9rem;
}
.cf-summary-actions{
  position: relative;
  z-index: 50;
}
.cf-help-btn{
  position: relative;
  z-index: 51;
  cursor: pointer;
}

</style>
<!-- –°—É–º–º–∞—Ä–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
<div class="cf-summary-block">
    <div>–°–æ–∑–¥–∞–Ω–æ FL: {{ total_created_cf|intcomma }}</div>
    <div>–í—ã—Ä–∞—â–µ–Ω–æ: {{ all_cf_grown|floatformat:0|intcomma }}</div>
    <div>–û—Å—Ç–∞–ª–æ—Å—å: {{ cf_left|floatformat:0|intcomma }}</div>
</div>
<div class="cf-summary-actions">
  <button type="button" class="cf-help-btn" id="open-instruction">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
</div>
{% if messages %}
<div class="messages-wrap">
    {% for message in messages %}
        <div class="custom-message custom-message-{{ message.tags }}">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}
<div class="trees-main-wrap">

    {# CF-–¥–µ—Ä–µ–≤–æ #}
    {% if cf_trees and cf_trees.0 %}
        {% with cf_tree=cf_trees.0 %}
    <a href="{% url 'tree_detail' cf_tree.id %}" class="tree-card-link">
            <div class="tree-card-wrapper">

        <div class="tree-card">

            <div class="grown-chip">
                –í—ã—Ä–∞—â–µ–Ω–æ: {{ user.cf_balance|floatformat:0|intcomma }} FL
            </div>
            <img class="tree-img"
                src="{% static 'images/tree_' %}{{ cf_tree.level }}.png"
                alt="FL Tree">

            <div class="tree-info-block">
                <div>–£—Ä–æ–≤–µ–Ω—å: {{ cf_tree.level }}</div>
                <div>–î–æ—Ö–æ–¥/—á: {{ cf_tree.income_per_hour|floatformat:1 }} FL</div>
                <div>–£–¥–æ–±—Ä–µ–Ω–∏–µ: {% if cf_tree.is_fertilized %}–ê–∫—Ç–∏–≤–Ω–æ{% else %}–ù–µ –∞–∫—Ç–∏–≤–Ω–æ{% endif %}</div>
                <div>–ê–≤—Ç–æ–ø–æ–ª–∏–≤: {% if cf_tree.is_auto_watered %}–ê–∫—Ç–∏–≤–Ω–æ{% else %}–ù–µ –∞–∫—Ç–∏–≤–Ω–æ{% endif %}</div>

            </div>


            </div>
            <a href="{% url 'tree_detail' cf_tree.id %}" class="tree-detail-btn"><p>–û—Ç–∫—Ä—ã—Ç—å</p></a>
</div>



        {% endwith %}
    {% endif %}

    {# TON-–¥–µ—Ä–µ–≤–æ #}
{% if ton_trees and ton_trees.0 %}
    {% with ton_tree=ton_trees.0 %}
    <a href="{% url 'tree_detail' ton_tree.id %}" class="tree-card-link">
        <div class="tree-card">
            <div class="grown-chip ton">
                –í—ã—Ä–∞—â–µ–Ω–æ: {{ user.ton_balance|floatformat:1|intcomma }} TON
            </div>
            <img class="tree-img"
                src="{% static 'images/ton_' %}{{ ton_tree.level }}.PNG"
                alt="TON Tree">
            <div class="tree-info-block">
                <div>–£—Ä–æ–≤–µ–Ω—å: {{ ton_tree.level }}</div>
<div>–î–æ—Ö–æ–¥/—á: {{ ton_tree.ton_per_hour|floatformat:2 }} TON</div>
                <div>–£–¥–æ–±—Ä–µ–Ω–∏–µ: {% if ton_tree.is_fertilized %}–ê–∫—Ç–∏–≤–Ω–æ{% else %}–ù–µ –∞–∫—Ç–∏–≤–Ω–æ{% endif %}</div>
                    <div>–ê–≤—Ç–æ–ø–æ–ª–∏–≤: {% if ton_tree.is_auto_watered %}–ê–∫—Ç–∏–≤–µ–Ω{% else %}–ù–µ –∞–∫—Ç–∏–≤–µ–Ω{% endif %}</div>
            </div>
        </div>
    </a>
        <a href="{% url 'tree_detail' ton_tree.id %}" class="tree-detail-btn"><p>–û—Ç–∫—Ä—ã—Ç—å</p></a>

    {% endwith %}


{% else %}
    <div class="tree-card tree-card-locked">
        <div class="locked-ton-overlay"></div>
        <img src="{% static 'images/locked.png' %}" alt="Locked" class="locked-ton-img">
        <form action="{% url 'shop:buy_ton_tree' %}" method="post" class="buy-ton-form">
            {% csrf_token %}
            <button type="submit" class="buy-ton-btn">
                –ö—É–ø–∏—Ç—å TON –¥–µ—Ä–µ–≤–æ –∑–∞ 5TON
            </button>
        </form>
    </div>


{% endif %}
</div>
<div class="custom-modal" id="instruction-modal">
  <div class="custom-modal-content">
    <button type="button" class="custom-modal-close" id="close-instruction" aria-label="Close">√ó</button>

    <h3 class="instruction-title">üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∫ –∏–≥—Ä–µ</h3>

<div class="instruction-text">
  <h4>1. –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã</h4>
  <p>–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã –æ—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é <b>¬´–î–µ—Ä–µ–≤–∞¬ª</b>.</p>

  <h4>2. –ú–µ–Ω—é —Å–ª–µ–≤–∞ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–æ–º)</h4>

  <h5>2.1. –ü–æ–ª–∏—Ç—å</h5>
  <ul>
    <li>–ü–æ–ª–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –≤ —Ç–µ—á–µ–Ω–∏–µ <b>5 —á–∞—Å–æ–≤</b> –∑–∞ –∫–∞–∂–¥—ã–π –ø–æ–ª–∏–≤</li>
    <li>–í–æ –≤—Ä–µ–º—è –ø–æ–ª–∏–≤–∞ —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –≤—ã–ø–∞–¥–∞—é—Ç <b>–≤–µ—Ç–∫–∏</b></li>
    <li>–ü–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–ª–∏–≤–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</li>
  </ul>

  <div class="rps-table-title">–£—Ä–æ–≤–Ω–∏ –¥–æ–±—ã—á–∏ –º–æ–Ω–µ—Ç FL –≤ —á–∞—Å</div>
  <table class="instruction-table">
    <thead>
      <tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–î–æ—Ö–æ–¥ (FL/—á–∞—Å)</th></tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>1 FL</td></tr>
      <tr><td>2</td><td>1,5 FL</td></tr>
      <tr><td>3</td><td>2 FL</td></tr>
      <tr><td>4</td><td>2,5 FL</td></tr>
      <tr><td>5</td><td>3 FL</td></tr>
    </tbody>
  </table>

  <h5>2.2. –°–æ–±—Ä–∞—Ç—å</h5>
  <ul>
    <li>–°–æ–±–∏—Ä–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã <b>FL</b></li>
    <li>–ú–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Äî –ø—Ä–∏ –ø–æ–ª–∏–≤–µ —Å–±–æ—Ä –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
  </ul>

  <h5>2.3. –ê–≤—Ç–æ–ø–æ–ª–∏–≤</h5>
  <ul>
    <li>–ü–æ–ª–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ <b>24</b> –∏–ª–∏ <b>48 —á–∞—Å–æ–≤</b></li>
    <li>–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω–∞ <b>–ª–µ–π–∫–∞</b>, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–¥–∞—ë—Ç—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω–µ</li>
  </ul>

  <h5>2.4. –£–¥–æ–±—Ä–µ–Ω–∏–µ</h5>
  <ul>
    <li>–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–±–æ—Ä –º–æ–Ω–µ—Ç <b>√ó2</b> –Ω–∞ <b>24 —á–∞—Å–∞</b></li>
  </ul>

  <h5>2.5. –£–ª—É—á—à–∏—Ç—å</h5>
  <ul>
    <li>–£–ª—É—á—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ä–µ–≤–∞, –µ—Å–ª–∏ —Ö–≤–∞—Ç–∞–µ—Ç <b>–≤–µ—Ç–æ–∫</b></li>
  </ul>

  <h5>2.6. –î–µ—Ä–µ–≤–æ TON</h5>
  <ul>
    <li>–ò–º–µ–µ—Ç —Ç–µ –∂–µ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ –∏ –¥–µ—Ä–µ–≤–æ FL</li>
    <li>–î–æ–±—ã–≤–∞–µ—Ç –º–æ–Ω–µ—Ç—ã TON —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è <b>–∞–∫—Ü–∏–π</b></li>
    <li><b>–í–ù–ò–ú–ê–ù–ò–ï:</b> TON –Ω–µ–ª—å–∑—è –¥–æ–±—ã–≤–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ ‚Äî —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–∏–æ–¥—ã –∞–∫—Ü–∏–π</li>
  </ul>

  <h4>3. –ú–µ–Ω—é —Å–Ω–∏–∑—É (–Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å)</h4>

  <h5>3.1. P2P (–†—ã–Ω–æ–∫)</h5>
  <ul>
    <li>–ë—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –ø–æ—Å–ª–µ —Ä–∞–∑–¥–∞—á–∏ –≤—Å–µ—Ö –º–æ–Ω–µ—Ç</li>
    <li><b>–û—Ä–¥–µ—Ä –Ω–∞ —Ä—ã–Ω–∫–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å</b> –ø–æ—Å–ª–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è</li>
    <li>–ü–æ–∫—É–ø–∫–∞ –º–æ–Ω–µ—Ç—ã FL –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∑–∞ TON</li>
  </ul>

  <h5>3.2. –†–µ—Ñ–µ—Ä–∞–ª—ã</h5>
  <ul>
    <li>–°–æ–¥–µ—Ä–∂–∏—Ç –≤–∞—à—É —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É</li>
    <li>–ö–Ω–æ–ø–∫–∞ <b>¬´–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞¬ª</b> –∫–æ–ø–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞</li>
    <li>–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏: –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç ‚Üí —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞ ‚Üí <b>¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª</b></li>
    <li>–¢–∞–º –∂–µ –µ—Å—Ç—å <b>–∑–∞–¥–∞–Ω–∏—è</b>, –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å FL</li>
  </ul>

  <h5>3.3. –ü—Ä–æ—Ñ–∏–ª—å</h5>
  <ul>
    <li>–ë–∞–ª–∞–Ω—Å FL –∏ TON</li>
    <li>–ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª—ë–∫ –¥–ª—è –ø–æ–∫—É–ø–æ–∫</li>
    <li>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ä–µ–≤—å—è –∏ –¥–æ—Ö–æ–¥/—á–∞—Å</li>
  </ul>

  <h5>3.4. –ú–∞–≥–∞–∑–∏–Ω</h5>
  <ul>
    <li>–¢–æ–≤–∞—Ä—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–æ—Ö–æ–¥–∞, –∞–≤—Ç–æ–ø–æ–ª–∏–≤–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–π</li>
    <li>–ï—Å—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å–æ –≤—Å–µ–º–∏ –∫—É–ø–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏</li>
  </ul>

  <hr class="instruction-hr">

  <div class="instruction-badge">‚úÖ –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã</div>
  <ol class="instruction-ol">
    <li><b>–í–µ—Ç–∫–∏</b> ‚Äî —Ä–µ—Å—É—Ä—Å –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞, –≤—ã–ø–∞–¥–∞—é—Ç —Å–ª—É—á–∞–π–Ω–æ –ø—Ä–∏ –ø–æ–ª–∏–≤–µ</li>
    <li><b>–õ–µ–π–∫–∞</b> ‚Äî –Ω—É–∂–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–ø–æ–ª–∏–≤–∞, –ø–æ–∫—É–ø–∞–µ—Ç—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω–µ</li>
    <li><b>–ê–∫—Ü–∏–∏</b> ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –¥–æ–±—ã—á–∏ TON</li>
    <li><b>–†–µ—Ñ–µ—Ä–∞–ª—ã</b> ‚Äî –ø—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã</li>
    <li><b>–ó–∞–¥–∞–Ω–∏—è</b> ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–ª—É—á–µ–Ω–∏—è FL</li>
  </ol>

  <div class="instruction-badge warn">‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</div>
  <ul class="instruction-warn">
    <li><b>–û—Ä–¥–µ—Ä –Ω–∞ P2P</b> –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è</li>
    <li><b>TON-–¥–µ—Ä–µ–≤–æ</b> —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∞–∫—Ü–∏–π</li>
    <li><b>–ê–≤—Ç–æ–ø–æ–ª–∏–≤</b> —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏—è –ª–µ–π–∫–∏</li>
    <li><b>–£–¥–æ–±—Ä–µ–Ω–∏–µ</b> —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ —É–¥–æ–±—Ä–µ–Ω–∏—è</li>
    <li><b>–£–ª—É—á—à–µ–Ω–∏–µ</b> —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤–µ—Ç–æ–∫</li>
  </ul>
</div>




    <button type="button" class="instruction-ok" id="ok-instruction">–ü–æ–Ω—è—Ç–Ω–æ</button>
  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        document.querySelectorAll('.custom-message').forEach(function(el) {
            el.style.transition = "opacity 0.5s";
            el.style.opacity = 0;
            setTimeout(() => el.remove(), 700);
        });
    }, 2600);
});
</script>
<script>

document.addEventListener('DOMContentLoaded', function () {
  const modal = document.getElementById('instruction-modal');
  const openBtn = document.getElementById('open-instruction');
  const closeBtn = document.getElementById('close-instruction');
  const okBtn = document.getElementById('ok-instruction');
console.log("instruction script loaded");

  function openModal(){
      console.log("open modal click");

    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  function closeModal(){
    modal.classList.remove('active');
    document.body.style.overflow = '';
  }

  if (openBtn) openBtn.addEventListener('click', openModal);
  if (closeBtn) closeBtn.addEventListener('click', closeModal);
  if (okBtn) okBtn.addEventListener('click', closeModal);

  // –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
  if (modal) {
    modal.addEventListener('click', function(e){
      if (e.target === modal) closeModal();
    });
  }

  // –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Esc
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape' && modal.classList.contains('active')) closeModal();
  });
});
</script>

{% endblock %}
