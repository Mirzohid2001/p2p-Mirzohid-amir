    {% extends 'base.html' %}
    {% load static %}
    {% load mask %}
    {% load humanize %}

    {% block title %}–ò–≥—Ä–∞ ‚Äî –ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞{% endblock %}

    {% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/rps.css' %}">
    {% endblock %}

    {% block content %}
    <div class="rps-game-container">
        {% if not game %}
        <!-- –í—ã–±–æ—Ä —Å—Ç–∞–≤–∫–∏ -->
        <div class="rps-betting card">
            <div class="betting-header">
                <h2>üí∞ –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É</h2>
                <a href="{% url 'rps:home' %}" class="btn-back">‚Üê –ù–∞–∑–∞–¥</a>
            </div>
            <div class="balance-info">
                <span>–í–∞—à –±–∞–ª–∞–Ω—Å: <strong>{{ user.cf_balance|floatformat:0|intcomma }} FL</strong></span>
            </div>
            <div class="search-status" id="search-status" style="display: none;">
                <div class="searching-animation">
                    <div class="spinner"></div>
                    <p>–ü–æ–∏—Å–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</p>
                    <p class="timer" id="search-timer">5</p>
                </div>
                <button class="btn-cancel-search" id="btn-cancel-search" style="display: none;">–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫</button>
            </div>
            <div class="bet-options">
                <button class="bet-btn" data-bet="1">1 FL</button>
                <button class="bet-btn" data-bet="3">3 FL</button>
                <button class="bet-btn" data-bet="5">5 FL</button>
                <button class="bet-btn" data-bet="10">10 FL</button>
            </div>
        </div>
        {% else %}
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div class="rps-game-screen card">
            <div class="game-header">
                <a href="{% url 'rps:home' %}" class="btn-back-small">‚Üê –ù–∞–∑–∞–¥</a>
                <div class="game-bank">
                    <span>–ë–∞–Ω–∫ –∏–≥—Ä—ã: <strong id="game-bank">{{ game.game_bank|floatformat:0|intcomma }} FL</strong></span>
                </div>
                <div class="game-timer" id="game-timer" >
                    <span id="timer-value">8</span>
                </div>
            </div>

            <div class="game-arena">
                <div class="player-card player-1">
                    <div class="player-name">{{ game.player1|mask_last:3 }}</div>
                    <div class="player-move" id="player1-move">
                        {% if game.player1_move %}
                            <div class="move-icon move-{{ game.player1_move }}">
                                {% if game.player1_move == 'rock' %}‚úä
                                {% elif game.player1_move == 'paper' %}üñêÔ∏è
                                {% elif game.player1_move == 'scissors' %}‚úåÔ∏è
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="move-placeholder">?</div>
                        {% endif %}
                    </div>
                </div>

                <div class="vs-badge">VS</div>

                <div class="player-card player-2">
                    <div class="player-name">
                        {% if game.is_bot_game %}{{ game.bot_name|default:"–ë–æ—Ç" }}{% else %}{{ game.player2|mask_last:3 }}{% endif %}
                    </div>
                    <div class="player-move" id="player2-move">
                        {% if game.status == 'finished' and game.player2_move %}
                            <div class="move-icon move-{{ game.player2_move }}">
                                {% if game.player2_move == 'rock' %}‚úä
                                {% elif game.player2_move == 'paper' %}üñêÔ∏è
                                {% elif game.player2_move == 'scissors' %}‚úåÔ∏è
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="move-placeholder">?</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% if game.status == 'betting' or game.status == 'playing' %}
            <div class="move-panel">
                <button class="move-btn" data-move="rock" title="–ö–∞–º–µ–Ω—å">
                    <div class="move-icon">‚úä</div>
                    <span>–ö–∞–º–µ–Ω—å</span>
                </button>
                <button class="move-btn" data-move="paper" title="–ë—É–º–∞–≥–∞">
                    <div class="move-icon">üñêÔ∏è</div>
                    <span>–ë—É–º–∞–≥–∞</span>
                </button>
                <button class="move-btn" data-move="scissors" title="–ù–æ–∂–Ω–∏—Ü—ã">
                    <div class="move-icon">‚úåÔ∏è</div>
                    <span>–ù–æ–∂–Ω–∏—Ü—ã</span>
                </button>
            </div>
            <div class="game-actions">
                <button class="btn-cancel-game" id="btn-cancel-game">–û—Ç–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É</button>
            </div>
            {% endif %}

            {% if game.status == 'finished' %}
            <div class="game-result" id="game-result">
                {% if game.result == 'draw' %}
                    <div class="result-message result-draw">
                        <h2>ü§ù –ù–∏—á—å—è!</h2>
                        <p>–°—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã</p>
                    </div>
                {% elif game.winner == user %}
                    <div class="result-message result-win">
                        <h2>üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!</h2>
                        <p>–í—ã –ø–æ–ª—É—á–∏–ª–∏ {{ game.game_bank|floatformat:0|intcomma }} FL</p>
                    </div>
                {% else %}
                    <div class="result-message result-loss">
                        <h2>üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏</h2>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!</p>
                    </div>
                {% endif %}
                <div class="result-actions">
        <button class="btn-rematch" id="btn-rematch" data-game-id="{{ game.id }}">üîÅ –ï—â—ë —Ä–∞–∑</button>
        <button class="btn-exit" id="btn-exit">üö™ –í—ã–π—Ç–∏</button>
    </div>

            </div>
            {% elif game.status == 'cancelled' %}
            <div class="game-result" id="game-result">
                <div class="result-message result-draw">
                    <h2>‚è±Ô∏è –ò–≥—Ä–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞</h2>
                    <p>–û–¥–∏–Ω –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ —Å–¥–µ–ª–∞–ª –≤—ã–±–æ—Ä. –°—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã.</p>
                </div>
                <div class="result-actions">
        <button class="btn-rematch" id="btn-rematch-cancelled" data-game-id="{{ game.id }}">üîÅ –ï—â—ë —Ä–∞–∑</button>
        <button class="btn-exit" id="btn-exit-cancelled">üö™ –í—ã–π—Ç–∏</button>
    </div>

            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <script>
        const gameId = {% if game %}{{ game.id }}{% else %}null{% endif %};
        const userId = {{ user.telegram_id }};
        const isPlayer1 = {% if is_player1 %}true{% else %}false{% endif %};
    </script>
    {% endblock %}

    {% block extra_js %}
    <script src="{% static 'js/rps.js' %}"></script>
    {% endblock %}

