    {% extends 'base.html' %}
    {% load static %}
    {% load mask %}
    {% load humanize %}
{% load i18n %}
    {% block title %}–ò–≥—Ä–∞ ‚Äî –ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞{% endblock %}

    {% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/rps.css' %}">
    {% endblock %}

    {% block content %}
    <div class="rps-game-container">
        {% if not game %}
        <!-- –í—ã–±–æ—Ä —Å—Ç–∞–≤–∫–∏ -->
        <div class="rps-betting card">
            <div class="betting-header">
                <h2>{% trans "üí∞ –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É" %}</h2>
                <a href="{% url 'rps:home' %}" class="btn-back">{% trans "‚Üê –ù–∞–∑–∞–¥" %}</a>
            </div>
            <div class="balance-info">
                <span>{% trans "–í–∞—à –±–∞–ª–∞–Ω—Å" %}: <strong>{{ user.cf_balance|floatformat:0|intcomma }} FL</strong></span>
            </div>
            <div class="search-status" id="search-status" style="display: none;">
                <div class="searching-animation">
                    <div class="spinner"></div>
                    <p>{% trans "–ü–æ–∏—Å–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞..." %}</p>
                    <p class="timer" id="search-timer">5</p>
                </div>
                <button class="btn-cancel-search" id="btn-cancel-search" style="display: none;">{% trans "–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫" %}</button>
            </div>
            <div class="bet-options">
                <button class="bet-btn" data-bet="1">1 FL</button>
                <button class="bet-btn" data-bet="3">3 FL</button>
                <button class="bet-btn" data-bet="5">5 FL</button>
                <button class="bet-btn" data-bet="10">10 FL</button>
            </div>
        </div>
        {% else %}
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div class="rps-game-screen card">
            <div class="game-header">
                <a href="{% url 'rps:home' %}" class="btn-back-small">{% trans "‚Üê –ù–∞–∑–∞–¥" %}</a>
                <div class="game-bank">
                    <span>{% trans "–ë–∞–Ω–∫ –∏–≥—Ä—ã" %}: <strong id="game-bank">{{ game.game_bank|floatformat:0|intcomma }} FL</strong></span>
                </div>
                <div class="game-timer" id="game-timer" >
                    <span id="timer-value">8</span>
                </div>
            </div>

            <div class="game-arena">
                <div class="player-card player-1">
                    <div class="player-name">{{ game.player1|mask_last:3 }}</div>
                    <div class="player-move" id="player1-move">
                        {% if game.player1_move %}
                            <div class="move-icon move-{{ game.player1_move }}">
                                {% if game.player1_move == 'rock' %}‚úä
                                {% elif game.player1_move == 'paper' %}üñêÔ∏è
                                {% elif game.player1_move == 'scissors' %}‚úåÔ∏è
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="move-placeholder">?</div>
                        {% endif %}
                    </div>
                </div>

                <div class="vs-badge">VS</div>

                <div class="player-card player-2">
                    <div class="player-name">
                        {% if game.is_bot_game %}{{ game.bot_name|default:_("–ë–æ—Ç")  }}{% else %}{{ game.player2|mask_last:3 }}{% endif %}
                    </div>
                    <div class="player-move" id="player2-move">
                        {% if game.status == 'finished' and game.player2_move %}
                            <div class="move-icon move-{{ game.player2_move }}">
                                {% if game.player2_move == 'rock' %}‚úä
                                {% elif game.player2_move == 'paper' %}üñêÔ∏è
                                {% elif game.player2_move == 'scissors' %}‚úåÔ∏è
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="move-placeholder">?</div>
                        {% endif %}
                    </div>
                </div>
            </div>

        <div class="game-result" id="game-result" style="display:none;"></div>


            {% if game.status == 'betting' or game.status == 'playing' %}
            <div class="move-panel">
                <button class="move-btn" data-move="rock" title="{% trans '–ö–∞–º–µ–Ω—å' %}">
                      <div class="move-icon">‚úä</div>
                      <span>{% trans "–ö–∞–º–µ–Ω—å" %}</span>
                    </button>

                    <button class="move-btn" data-move="paper" title="{% trans '–ë—É–º–∞–≥–∞' %}">
                      <div class="move-icon">üñêÔ∏è</div>
                      <span>{% trans "–ë—É–º–∞–≥–∞" %}</span>
                    </button>

                    <button class="move-btn" data-move="scissors" title="{% trans '–ù–æ–∂–Ω–∏—Ü—ã' %}">
                      <div class="move-icon">‚úåÔ∏è</div>
                      <span>{% trans "–ù–æ–∂–Ω–∏—Ü—ã" %}</span>
                    </button>

            </div>
            <div class="game-actions">
                <button class="btn-cancel-game" id="btn-cancel-game">{% trans "–û—Ç–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É" %}</button>
            </div>
            {% endif %}

            {% if game.status == 'finished' %}
            <div class="game-result" id="game-result">
                {% if game.result == 'draw' %}
                    <div class="result-message result-draw">
                        <h2>{% trans "ü§ù –ù–∏—á—å—è!" %}</h2>
                        <p>{% trans "–°—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã" %}</p>

                    </div>
                {% elif game.winner == user %}
                    <div class="result-message result-win">
                        <h2>{% trans "üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!" %}</h2>
                        <p>
                          {% blocktrans with amount=game.game_bank|floatformat:0|intcomma %}
                          –í—ã –ø–æ–ª—É—á–∏–ª–∏ {{ amount }} FL
                          {% endblocktrans %}
                        </p>

                    </div>
                {% else %}
                    <div class="result-message result-loss">
                        <h2>{% trans "üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏" %}</h2>
<p>{% trans "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!" %}</p>

                    </div>
                {% endif %}
                <div class="result-actions">
        <button class="btn-rematch"
        id="btn-rematch"
        data-bet="{{ game.bet_amount }}">
  üîÅ {% trans "–ï—â—ë —Ä–∞–∑" %}
</button>

        <button class="btn-exit" id="btn-exit">üö™ {% trans "–í—ã–π—Ç–∏" %}</button>
    </div>

            </div>
            {% elif game.status == 'cancelled' %}
            <div class="game-result" id="game-result">
                <div class="result-message result-draw">
                    <h2>{% trans "‚è±Ô∏è –ò–≥—Ä–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞" %}</h2>
<p>{% trans "–û–¥–∏–Ω –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ —Å–¥–µ–ª–∞–ª –≤—ã–±–æ—Ä. –°—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã." %}</p>

                </div>
                <div class="result-actions">
        <button class="btn-rematch"
        id="btn-rematch-cancelled"
        data-bet="{{ game.bet_amount }}">
  üîÅ –ï—â—ë —Ä–∞–∑
</button>

        <button class="btn-exit" id="btn-exit-cancelled">üö™ –í—ã–π—Ç–∏</button>
    </div>

            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

        <script>
  window.I18N_RPS_GAME = {
    searching: "{% trans '–ü–æ–∏—Å–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...' %}",
    cancel_search: "{% trans '–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫' %}",
    cancel_game: "{% trans '–û—Ç–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É' %}",
    bot: "{% trans '–ë–æ—Ç' %}",
    rock: "{% trans '–ö–∞–º–µ–Ω—å' %}",
    paper: "{% trans '–ë—É–º–∞–≥–∞' %}",
    scissors: "{% trans '–ù–æ–∂–Ω–∏—Ü—ã' %}",
    game_bank: "{% trans '–ë–∞–Ω–∫ –∏–≥—Ä—ã' %}",
    back: "{% trans '‚Üê –ù–∞–∑–∞–¥' %}",
    vs: "{% trans 'VS' %}",
  };
</script>

      <script>
  window.I18N_RPS = {
    // –æ–±—â–∏–µ
    wins: "{% trans '–ü–æ–±–µ–¥' %}",
    losses: "{% trans '–ü–æ—Ä–∞–∂–µ–Ω–∏–π' %}",
    draws: "{% trans '–ù–∏—á—å–∏—Ö' %}",
    games: "{% trans '–∏–≥—Ä' %}",
    vs: "{% trans 'vs' %}",

    // —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è/–æ—à–∏–±–∫–∏
    result_too_long: "{% trans '–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–≥–æ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.' %}",
    opponent_found: "{% trans '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω!' %}",
    search_error: "{% trans '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∏–≥—Ä—ã' %}",
    bot_connecting: "{% trans '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ...' %}",
    bot_connected: "{% trans '–ü–æ–¥–∫–ª—é—á–µ–Ω!' %}",
    bot_connect_error: "{% trans '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –±–æ—Ç–∞' %}",
    search_cancelled: "{% trans '–ü–æ–∏—Å–∫ –æ—Ç–º–µ–Ω–µ–Ω' %}",
    id_not_found: "{% trans '–û—à–∏–±–∫–∞: ID –∏–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω' %}",
    cancel_confirm: "{% trans '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É? –°—Ç–∞–≤–∫–∏ –±—É–¥—É—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã.' %}",
    cancel_success: "{% trans '–ò–≥—Ä–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞, —Å—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã' %}",
    cancel_error_prefix: "{% trans '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∏–≥—Ä—ã: ' %}",
    time_extra: "{% trans '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: +7 —Å–µ–∫—É–Ω–¥' %}",
    time_over: "{% trans '–í—Ä–µ–º—è –≤—ã—à–ª–æ!' %}",
    wait_result: "{% trans '–û–∂–∏–¥–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç...' %}",
    move_error: "{% trans '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–≤–µ—Ä—à–µ–Ω–∏–∏ —Ö–æ–¥–∞' %}",
    rematch_created: "{% trans '–ù–æ–≤–∞—è –∏–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞!' %}",
    rematch_error: "{% trans '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∏–≥—Ä—ã' %}",

    // –∫–Ω–æ–ø–∫–∏
    rematch_btn: "{% trans 'üîÅ –ï—â—ë —Ä–∞–∑' %}",
    exit_btn: "{% trans 'üö™ –í—ã–π—Ç–∏' %}",

    // —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω (finalizeGameUI)
    game_cancelled_title: "{% trans '‚è±Ô∏è –ò–≥—Ä–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞' %}",
    game_cancelled_text: "{% trans '–û–¥–∏–Ω –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ —Å–¥–µ–ª–∞–ª –≤—ã–±–æ—Ä. –°—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã.' %}",

    draw_title: "{% trans 'ü§ù –ù–∏—á—å—è!' %}",
    draw_text: "{% trans '–°—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã' %}",

    win_title: "{% trans 'üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!' %}",
    win_got_prefix: "{% trans '–í—ã –ø–æ–ª—É—á–∏–ª–∏' %}",
    congrats: "{% trans '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!' %}",

    lose_title: "{% trans 'üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏' %}",
    lose_text: "{% trans '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!' %}",

    game_finished_title: "{% trans '‚úÖ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞' %}",
    game_finished_text: "{% trans '–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–µ–Ω.' %}",
  };
</script>



    <script>
        const gameId = {% if game %}{{ game.id }}{% else %}null{% endif %};
        const userId = {{ user.telegram_id }};
        const isPlayer1 = {% if is_player1 %}true{% else %}false{% endif %};
    </script>
    {% endblock %}

    {% block extra_js %}
    <script src="{% static 'js/rps.js' %}"></script>
    {% endblock %}

